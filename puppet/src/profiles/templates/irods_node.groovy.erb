import jenkins.model.*
import hudson.model.*
import hudson.slaves.*
import hudson.plugins.sshslaves.*
import java.util.ArrayList;
import hudson.slaves.EnvironmentVariablesNodeProperty.Entry;
import hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy;

import com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey
import com.cloudbees.plugins.credentials.CredentialsScope

import com.cloudbees.plugins.credentials.impl.*;
import com.cloudbees.plugins.credentials.*;
import com.cloudbees.plugins.credentials.domains.*;


// Create joeuser, save id for later
def joeuser_id = java.util.UUID.randomUUID().toString()

def ks = new BasicSSHUserPrivateKey(CredentialsScope.SYSTEM,
    joeuser_id,
    "joeuser",
    new BasicSSHUserPrivateKey.UsersPrivateKeySource(),
    "",
    "")

SystemCredentialsProvider.getInstance().getStore().addCredentials(Domain.global(), ks)



//  List<Entry> env = new ArrayList<Entry>();
//  env.add(new Entry("key1","value1"))
//  env.add(new Entry("key2","value2"))
//  EnvironmentVariablesNodeProperty envPro = new EnvironmentVariablesNodeProperty(env);

  Slave slave = new DumbSlave(
                    "irods",                   // name
                    "Irods node",              // nodeDescription
                    "/var/tmp/",               // remoteFS
                    "4",                       // numExecutors
                    Node.Mode.NORMAL,          // mode "Usage" field, EXCLUSIVE is "only tied to node", NORMAL is "any"
                    "irods-node",              // labelString
                    new SSHLauncher("localhost",   // host
                        22,                        // port
                        SSHLauncher.lookupSystemCredentials(joeuser_id), // creds (from above)
                        "",                        // jvmOptions
                        "",                        // javaPath
                        null,                      // JDKInstaller
                        "",                        // prefixStartSlaveCmd
                        "",                        // suffixStartSlaveCmd
                        100,                       // launchTimeoutSeconds
                        3,                         // maxNumRetries
                        3,                         // retryWaitTime
                        new NonVerifyingKeyVerificationStrategy()),  //  verification strategy
                    new RetentionStrategy.Always(), // retentionStrategy
                    new LinkedList())          // nodeProperties
//  slave.getNodeProperties().add(envPro)
  Jenkins.instance.addNode(slave)


